<!DOCTYPE html>
<html lang="en">
<head>

 <title>Kiln Controller</title>
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <script src="assets/js/jquery-1.10.2.min.js"></script>
 <script src="assets/js/jquery.event.drag-2.2.js"></script>
 <script src="assets/js/jquery.flot.js"></script>
 <script src="assets/js/jquery.flot.resize.js"></script>
 <script src="assets/js/jquery.flot.draggable.js"></script>
 <script src="assets/js/bootstrap.min.js"></script>
 <script src="assets/js/jquery.bootstrap-growl.min.js"></script>
 <script src="assets/js/select2.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <script src="assets/js/picoreflow.js"></script>

 <link rel="stylesheet" href="assets/css/bootstrap.min.css"/>
 <link rel="stylesheet" href="assets/css/bootstrap-theme.min.css"/>
 <link rel="stylesheet" href="assets/css/bootstrap-modal.css"/>
 <link rel="stylesheet" href="assets/css/select2.css"/>
 <link rel="stylesheet" href="assets/css/picoreflow.css"/>
 <link rel="icon" href="assets/images/kiln-icon.png"/>

</head>
<body>

 <div class="container">
  <!-- Kiln Controller Dashboard - Modern Card Layout -->
  <div id="status" class="kiln-dashboard">

   <!-- Primary Metric - Current Temperature (Hero Card) -->
   <div class="metric-hero">
    <div class="metric-hero-inner">
     <div class="metric-label">Current Temperature</div>
     <div class="metric-display">
      <span class="metric-value-hero" id="act_temp">25</span>
      <span class="metric-unit-hero" id="act_temp_scale">&deg;C</span>
     </div>
     <div class="metric-sublabel" id="state">IDLE</div>
    </div>
   </div>

   <!-- Secondary Metrics Grid -->
   <div class="metrics-grid">

    <!-- Target Temperature Card -->
    <div class="metric-card target-card">
     <div class="metric-card-header">
      <span class="metric-icon">&#9678;</span>
      <span class="metric-title">Target</span>
     </div>
     <div class="metric-card-value">
      <span class="metric-number" id="target_temp">---</span>
      <span class="metric-suffix" id="target_temp_scale">&deg;C</span>
     </div>
     <div class="error-chart-container">
      <canvas id="errorChart"></canvas>
     </div>
    </div>

    <!-- Cost Card -->
    <div class="metric-card cost-card">
     <div class="metric-card-header">
      <span class="metric-icon">&#36;</span>
      <span class="metric-title">Cost</span>
     </div>
     <div class="metric-card-value">
      <div class="time-display">
       <span class="time-remaining" id="cost">$0.00</span>
       <span><span class="time-completion" id="kwh">0.00</span><span class="metric-suffix"> KWH</span></span>
      </div>
     </div>
    </div>

    <!-- Time Remaining Card -->
    <div class="metric-card time-card">
     <div class="metric-card-header">
      <span class="metric-icon">&#x23F1;</span>
      <span class="metric-title">Time</span>
     </div>
     <div class="metric-card-value">
      <div class="time-display">
       <span class="time-remaining" id="time_remaining">---</span>
       <span class="time-completion" id="time_completion">---</span>
      </div>
     </div>
     <div class="progress-chart-container">
      <canvas id="progressChart"></canvas>
      <span class="progress-percent" id="progress_percent">0%</span>
     </div>
    </div>

    <!-- Schedule Card (shown when scheduled) -->
    <div class="metric-card schedule-card" id="schedule-status" style="display:none;">
     <div class="metric-card-header">
      <span class="metric-icon">&#9719;</span>
      <span class="metric-title">Scheduled</span>
     </div>
     <div class="metric-card-value schedule-time">
      <span class="schedule-text"></span>
     </div>
    </div>

   </div>

   <!-- Status Bar with Indicators -->
   <div class="status-bar">

    <!-- System Indicators -->
    <div class="system-indicators">
     <div class="indicator-group">
      <div class="indicator-with-label">
       <span class="indicator" id="heat" title="Heating Element" data-label="HEAT">&#92;</span>
       <span class="indicator-percentage" id="heat_percentage" style="display:none;">0%</span>
      </div>
      <div class="indicator-with-label">
       <span class="indicator" id="errors" title="Thermocouple Errors" data-label="ERR">&#9888;</span>
       <span class="indicator-percentage" id="error_percentage" style="display:none;">0%</span>
      </div>
      <div class="indicator-with-label">
       <span class="indicator" id="catchup" title="Catching Up" data-label="SYNC">&#10227;</span>
      </div>
      <span class="indicator" id="hazard" title="Warning" data-label="WARN">&#73;</span>
      <span class="indicator" id="timer" title="Timer Active" data-label="TIME">&#x29D6;</span>
     </div>
    </div>

   </div>

  </div>
  <div class="panel panel-default">
   <div class="panel-heading">

    <!-- Profile Control Bar -->
    <div class="profile-control-bar">

     <!-- Profile Selector Section -->
     <div class="profile-selector-section" id="profile_selector">
      <div class="profile-selector-label">Schedule</div>
      <div class="profile-selector-input">
       <select id="e2" class="select2"></select>
      </div>
      <div class="profile-selector-actions">
       <button id="btn_edit" type="button" class="control-btn control-btn-edit" onclick="enterEditMode()" title="Edit Schedule">
        <span class="glyphicon glyphicon-edit"></span>
       </button>
       <button id="btn_new" type="button" class="control-btn control-btn-new" onclick="enterNewMode(selected_profile)" title="New Schedule">
        <span class="glyphicon glyphicon-plus"></span>
       </button>
      </div>
     </div>

     <!-- Running Profile Display -->
     <div class="running-profile-display" id="running_profile_heading" style="display:none;">
      <div class="running-profile-label">Running Schedule</div>
      <div class="running-profile-name"></div>
     </div>

     <!-- Scheduled Countdown Display -->
     <div class="scheduled-profile-display" id="scheduled_countdown" style="display:none;">
      <div class="scheduled-profile-label">Scheduled</div>
      <div class="scheduled-profile-info">
       <div id="schedule_time_display"></div>
       <div id="countdown_display"></div>
      </div>
     </div>

     <!-- Control Buttons Section -->
     <div class="control-buttons-section" id="btn_controls">
      <div id="nav_start" style="display:none">
       <button type="button" class="control-btn control-btn-start" data-toggle="modal" data-target="#jobSummaryModal">
        <span class="glyphicon glyphicon-play"></span>
        <span class="control-btn-text">Start</span>
       </button>
      </div>
      <button id="nav_stop" type="button" class="control-btn control-btn-stop" data-toggle="modal" data-target="#stopKilnModal" style="display:none">
       <span class="glyphicon glyphicon-stop"></span>
       <span class="control-btn-text">Stop</span>
      </button>
     </div>

    </div>

    <!-- Edit Mode -->
    <div class="edit-mode-bar" id="edit" style="display:none;">

     <div class="edit-section">
      <div class="edit-input-group">
       <label class="edit-label">Schedule Name</label>
       <input id="form_profile_name" type="text" class="edit-input" placeholder="Enter schedule name" />
      </div>

      <div class="edit-input-group">
       <label class="edit-label">Description</label>
       <input id="form_profile_description" type="text" class="edit-input" placeholder="Enter description" />
      </div>
     </div>

     <div class="edit-actions">
      <div class="edit-actions-left">
       <button id="btn_newPoint" type="button" class="control-btn control-btn-small" onclick="newPoint()" title="Add Point">
        <span class="glyphicon glyphicon-plus"></span>
       </button>
       <button id="btn_delPoint" type="button" class="control-btn control-btn-small" onclick="delPoint()" title="Remove Point">
        <span class="glyphicon glyphicon-minus"></span>
       </button>
       <button id="btn_delProfile" type="button" class="control-btn control-btn-small control-btn-danger" data-toggle="modal" data-target="#delProfileModal" title="Delete Schedule">
        <span class="glyphicon glyphicon-trash"></span>
       </button>
      </div>
      <div class="edit-actions-right">
       <button class="control-btn control-btn-save" type="button" onclick="saveProfile();">
        <span class="glyphicon glyphicon-ok"></span>
        <span class="control-btn-text">Save</span>
       </button>
       <button id="btn_exit" type="button" class="control-btn" onclick="leaveEditMode()">
        <span class="glyphicon glyphicon-remove"></span>
        <span class="control-btn-text">Cancel</span>
       </button>
      </div>
     </div>

    </div>

   </div>
   <div class="panel-body">
    <div id="graph_container" class="graph"></div>
   </div>
   <div id="profile_table" class="panel-footer"></div>
  </div>
 </div>

 <div id="jobSummaryModal" class="modal fade" tabindex="-1" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     <h3 class="modal-title" id="jobSummaryModalLabel">Task Overview</h3>
    </div>
    <div class="modal-body">
     <table class="table table-bordered">
      <tr><td>Selected Profile</td><td><b><span id="sel_prof"></span></b></td></tr>
      <tr><td>Estimated Runtime</td><td><b><span id="sel_prof_eta"></span></b></td></tr>
      <tr><td>Estimated Power consumption</td><td><b><span id="sel_prof_cost"></span></b></td></tr>
     </table>
    </div>
    <div class="modal-footer">
     <div class="btn-group" style="width: 100%">
      <button type="button" class="btn btn-danger" style="width: 50%" data-dismiss="modal">No, take me back</button>
      <button type="button" class="btn btn-success" style="width: 50%" data-dismiss="modal" onclick="runTask()">Yes, start the Run now</button>
     </div>
     <div class="schedule-group">
       <input type="datetime-local" id="scheduled-run-time">
       <button type="button" class="btn btn-primary" style="width: 50%" data-dismiss="modal" onclick="scheduleTask()">Schedule start for later</button>
     </div>
    </div>
   </div>
  </div>
 </div>

 <div id="delProfileModal" class="modal fade" tabindex="-1" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     <h3 class="modal-title" id="delProfileModalLabel">Delete this profile?</h3>
    </div>
    <div class="modal-body">
     Do your really want to delete this profile?
    </div>
    <div class="modal-footer">
     <div class="btn-group" style="width: 100%">
      <button type="button" class="btn btn-danger" style="width: 50%" data-dismiss="modal">No, take me back</button>
      <button type="button" class="btn btn-success" style="width: 50%" data-dismiss="modal" onclick="deleteProfile()">Yes, delete the profile</button>
     </div>
    </div>
   </div>
  </div>
 </div>

 <div id="overwriteProfileModal" class="modal fade" tabindex="-1" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     <h3 class="modal-title" id="overwriteProfileModalLabel">Overwrite this profile?</h3>
    </div>
    <div class="modal-body">
     Do your really want to overwrite this profile?
    </div>
    <div class="modal-footer">
     <div class="btn-group" style="width: 100%">
      <button type="button" class="btn btn-danger" style="width: 50%" data-dismiss="modal">No, take me back</button>
      <button type="button" class="btn btn-success" style="width: 50%" data-dismiss="modal" onclick="deleteProfile()">Yes, delete the profile</button>
     </div>
    </div>
   </div>
  </div>
 </div>

 <div id="runSummaryModal" class="modal fade" tabindex="-1" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     <h3 class="modal-title" id="runSummaryModalLabel">Run Summary</h3>
    </div>
    <div class="modal-body">
     <table class="table table-bordered">
      <tr><td>Start Time</td><td><b><span id="summary_start_time">---</span></b></td></tr>
      <tr><td>Duration</td><td><b><span id="summary_duration">---</span></b></td></tr>
      <tr><td>Cost</td><td><b><span id="summary_cost">---</span></b></td></tr>
      <tr><td>Power</td><td><b><span id="summary_kwh">---</span> KWH</b></td></tr>
     </table>
    </div>
    <div class="modal-footer">
     <button type="button" class="btn btn-primary" style="width: 100%" data-dismiss="modal">OK</button>
    </div>
   </div>
  </div>
 </div>

 <div id="stopKilnModal" class="modal fade" tabindex="-1" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
     <h3 class="modal-title" id="stopKilnModalLabel">Stop the kiln?</h3>
    </div>
    <div class="modal-body">
     Are you sure you want to stop the kiln?
    </div>
    <div class="modal-footer">
     <div class="btn-group" style="width: 100%">
      <button type="button" class="btn btn-danger" style="width: 50%" data-dismiss="modal">No, take me back</button>
      <button type="button" class="btn btn-success" style="width: 50%" data-dismiss="modal" onclick="confirmStopKiln()">Yes, stop the kiln</button>
     </div>
    </div>
   </div>
  </div>
 </div>

</body>
</html>
